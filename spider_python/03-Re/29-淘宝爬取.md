# 淘宝爬取

url = "https://s.taobao.com/search?q=蚊香&imgfile=&js=1&stats_click=search_radio_all%3A1&initiative_id=staobaoz_20180607&ie=utf8" # 第一页

https://s.taobao.com/search?q=%E8%9A%8A%E9%A6%99&imgfile=&js=1&stats_click=search_radio_all%3A1&initiative_id=staobaoz_20180607&ie=utf8&bcoffset=3&ntoffset=3&p4ppushleft=1%2C48&s=44  # 第二页s=44

https://s.taobao.com/search?q=%E8%9A%8A%E9%A6%99&imgfile=&js=1&stats_click=search_radio_all%3A1&initiative_id=staobaoz_20180607&ie=utf8&bcoffset=0&ntoffset=6&p4ppushleft=1%2C48&s=88 # 第三页s=88

## 功能描述

目标：获取淘宝搜索页面，提取其中商品名称和价格
理解：淘宝的搜索接口，翻页的处理
技术路线：requests + re

淘宝搜索Robot协议不允许爬虫，清不要不加限制的爬取这个网站

## 程序结构设计

1. 提交商品搜索请求，获得页面
2. 提取商品名称和价格信息
3. 将信息输出到屏幕上

## 代码

```python
# -*- coding: utf-8 -*-
"""
Created on Thu Jun  7 23:09:17 2018

@author: Administrator
"""

import requests
import re


def getHTMLText(url):
    try:
        r = requests.get(url, timeout = 30)
        r.raise_for_status()
        r.encoding = r.apparent_encoding
        return r.text
    except:
        return ''


def parsePage(ilt, html):
    try:
        plt = re.findall(r'\"view_price\"\:\"[\d\. ]*\"',html)
        tlt = re.findall(r'\"raw_title\"\:\".*?\"', html)
        for i in range(len(plt)):
            price = eval(plt[i].split(':')[1])
            title = eval(tlt[i].split(':')[1])
            ilt.append([price, title])
    except:
        print("")


def printGoodsList(ilt):
    tplt = "{:4}\t{:8}\t{:16}"
    print(tplt.format("序号","价格","商品名称"))
    count = 0
    for g in ilt:
        count = count + 1
        print(tplt.format(count, g[0], g[1]))
    
    
def main():
    goods = "蚊香"
    depth = 2
    start_url = "https://s.taobao.com/search?q=" + goods
    infoList = []
    for i in range(depth):
        try:
            url = start_url + '&s=' + str(44*i)
            html = getHTMLText(url)
            parsePage(infoList, html)
        except:
            continue
    printGoodsList(infoList)
    
main()
            
            
```

## 运行结果
```
runfile('C:/Users/Administrator/Desktop/taobao.py', wdir='C:/Users/Administrator/Desktop')
序号      价格              商品名称            
   1    10.80           榄菊蚊香大盘野菊花蚊香36单盘桶装送蚊香
   2    19.80           皎洁电热蚊香片90片送加热器套装插电式家用驱蚊防蚊灭蚊片无味型
   3    24.90           皎洁电热蚊香液无味加热器插电式家用驱蚊防蚊婴幼儿孕妇灭蚊液体
   4    23.80           雷达电蚊香片无线加热器套装无香电蚊香套装 驱蚊器蚊香片
   5    43.00           润本蚊香液无味婴儿驱蚊防蚊用品儿童宝宝电蚊香家用插电式6液2器
   6    39.80           润本电热蚊香液婴儿宝宝驱蚊无味液体家用插电式非孕妇补充装6瓶
   7    48.90           子初儿童蚊香液无味婴儿驱蚊用品宝宝电热防蚊家用插电式6瓶送2器
   8    47.90           可优比蚊香液婴儿孕妇电蚊驱蚊液新生儿宝宝电热防蚊家用6瓶送2器
   9    54.90           gb好孩子蚊香液无味婴儿孕妇驱蚊液室内电热灭蚊水球形宝宝无味型
  10    65.00           呵护婴儿电蚊香液无味宝宝孕妇驱蚊液套装无香儿童驱蚊用品
  11    49.90           润本电热蚊香液儿童宝宝灭蚊驱蚊液水补充装无味型45ml8瓶电蚊香
  12    59.00           青蛙王子电蚊香液无味婴儿童宝宝无香型电热蚊香器驱蚊家用插电式
  13    24.90           润本蚊香片90片儿童灭蚊片孕妇宝宝无味婴儿电热蚊香片送驱蚊器
  14    39.90           青蛙王子电蚊香液无味婴儿驱蚊液儿童用品无香型防蚊新生宝宝专用
  15    29.90           儿童蚊香液无味婴儿孕妇驱蚊用品新生儿宝宝电热防蚊6瓶装无香型
  16    49.90           子初电热蚊香液10瓶+2器电蚊香孕妇无味驱蚊液
  17    19.90           润本电热蚊香液无香型45ml*3瓶家用防蚊水驱蚊液夏季无味型防蚊液
  18    57.90           润本宝宝电热蚊香液45ml*10瓶 家用灭蚊液水驱蚊液体无味套装
  19    34.80           家德宝婴儿电蚊香液孕妇宝宝无味驱蚊液熟睡宝蚊香液3液1器套装
  20    176.00          露安适婴儿电热蚊香液 宝宝驱蚊电热液液体蚊香2瓶1器
  21    45.90           petersbees电热蚊香液家用蚊香灭蚊液室内防蚊水驱蚊液无味型送器
  22    18.90           润本蚊香片电热蚊香片室内蚊香片驱蚊片防蚊片送加热器72片套装
  23    29.90           青蛙王子电热蚊香液儿童无味型婴儿孕妇新生儿宝宝可用补充装45ml
  24    19.90           布布宝贝蚊香液婴儿电蚊香驱蚊器宝宝儿童孕妇家用无味型3瓶送1器
  25    48.90           家德宝电热蚊香液婴儿驱蚊液宝宝无味熟睡宝防蚊液4液1带线器套装
  26    47.00           哆咪奇婴幼儿蚊香液套盒婴幼儿童孕妇驱蚊液电热蚊香器2液送1器
  27    48.90           润本电热蚊香片室内防蚊驱蚊片家用套装蚊香片蚊片无味型送器
  28    199.00          露安适婴儿电热蚊香液 宝宝驱蚊电热液电热液体蚊香3瓶1器
  29    23.90           润本电热蚊香液45ml*2瓶+加热器装家用蚊香液无香型防蚊液驱蚊液
  30    43.90           好孩子电热蚊香液套装婴儿孕妇专用宝宝儿童驱蚊液无味灭蚊水防蚊
  31    39.00           青蛙王子婴儿童电热蚊香液无味婴儿孕妇宝宝新生儿无香型驱蚊用品
  32    22.90           润本电热蚊香片宝宝怀孕妇新生婴儿童驱蚊片无味型补充装3盒90片
  33    28.90           可优比电蚊香液婴儿宝宝无味蚊香液儿童孕妇驱蚊液套装3瓶送加热
  34    22.90           新妙宝宝电热蚊香液无味婴儿孕妇专用驱蚊用品儿童防灭蚊液无香型
  35    39.80           蚊香液无味婴儿孕妇宝宝无香型家用电加热驱蚊器儿童防蚊补充套装
  36    36.80           润本婴儿童电热蚊香液防蚊液 宝宝驱蚊用品无味型夏季5瓶送加热器
  37    35.90           青蛙王子电热蚊香液6瓶家居补充套装无味新生宝宝婴儿补充驱蚊液
  38    98.00           朋禾婴儿童电热驱蚊器进口原液蚊香液驱蚊液用品新生儿无味套装
  39    36.90           5瓶装润本蚊香液 婴儿宝宝驱蚊液无味电蚊香器家用插电式无香型
  40    69.00           布朗博士同款婴儿电热蚊香液无味孕妇宝宝专用儿童驱蚊液防蚊用品
  41    18.90           皎洁电热蚊香液无味3瓶套装孕妇婴儿儿童宝宝防蚊驱蚊液送加热器
  42    58.00           适樱宝电热蚊香液儿童金盾宝宝驱蚊液孕妇婴儿无味日本进口防蚊液
  43    45.00           日本原装进口小林日优婴儿植物电热蚊香液 宝宝儿童驱蚊液3瓶装
  44    19.80           【1器+3液】电热蚊香液宝宝防蚊液儿童灭蚊无味孕妇新生婴儿驱蚊
  45    69.00           宝宝金水婴儿蚊香液儿童驱蚊液宝宝电热驱蚊蚊香驱蚊液6瓶
  46    29.80           青蛙王子电热蚊香液宝宝驱蚊液儿童无味孕妇适用新生婴儿驱蚊用品
  47    39.90           otbaby蚊香液2瓶送加热器家用电蚊香液水驱蚊无味灭蚊无烟YA06
  48    69.00           金盾蚊香液无味婴儿孕妇防蚊4瓶宝宝无味型日本液进口原液包邮
  49    43.80           贝蒂儿婴儿蚊香液加热器套装 无味 驱蚊液 6瓶液+2个加热器
  50    34.80           麦康舒酷婴儿电蚊香液套装孕妇宝宝防蚊液6瓶2器新生儿驱蚊液用品
  51    79.90           御信堂婴儿驱蚊液无烟无味型新生儿童宝宝驱蚊用品电热蚊香液正品
  52    79.00           金盾电热蚊香液45ml*4瓶液1盒 驱蚊防蚊防叮咬 无味液送加热器1个
  53    24.90           五羊电热蚊香液宝宝孕妇无味型电蚊香4瓶新生儿童婴儿驱蚊专用品
  54    79.00           金盾婴宝婴儿蚊香液孕妇无味4瓶红番茄儿童电热驱蚊液包邮
  55    24.90           青蛙王子电热蚊香液3瓶婴儿童宝宝驱蚊液孕妇无味灭蚊器 送加热器
  56    49.90           金盾驱蚊无味型电热蚊香片补充105片装家用灭蚊儿童婴儿宝宝卧室
  57    35.90           皎洁电热蚊香液无味10瓶补充套装孕妇宝宝驱蚊婴儿童无味防蚊液体
  58    59.00           诺比蚊香液无味婴儿孕妇驱蚊液电热液体套装驱蚊液充电7液+2器
  59    83.90           安贝儿 婴儿电热蚊香液套装 宝宝驱蚊液水 防蚊虫6瓶送片液两用器
  60    192.00          安徽正峰日化春蛙畜牧蚊香50单盘12小时猪场鸡鸭牛兔羊用养殖场用
  61    38.00           正品米兜熊电热蚊香液婴儿孕妇儿童专用驱蚊液安全无味4液加2插头
  62    24.90           五羊婴儿电热蚊香液套装(45ml*4+1器)婴儿宝宝防蚊液
  63    49.00           宝宝金水电蚊香液4瓶婴儿宝宝无味蚊香液儿童孕妇驱蚊液套装
  64    39.90           御信堂婴儿电蚊香片儿童孕妇宝宝专用无味驱蚊防蚊120片送2加热器
  65    47.80           安贝儿 婴儿电热蚊香液 宝宝驱蚊液水儿童防蚊45ml 3瓶装送蚊香器
  66    26.90           润本婴儿电热蚊香无味液宝宝驱蚊水灭蚊液补充装无味型4瓶套装
  67    39.80           安贝儿婴儿电蚊香液孕妇宝宝专用无味无香型新生幼儿童用的蚊香液
  68    39.90           贝蒂儿电热蚊香液无味驱蚊液草本香套装6瓶液补充装无器
  69    37.90           淳一婴儿蚊香液驱蚊液套装 宝宝儿童电热驱蚊液防蚊液2瓶送加热器
  70    24.90           青蛙王子电热蚊香液防蚊儿童无香味孕妇新生婴儿驱蚊用品3液1器
  71    39.00           安迪贝比电蚊香液无味型婴儿孕妇 儿童驱蚊宝宝防蚊5瓶套装加热器
  72    42.00           御信堂婴儿电热蚊香液45ml*3瓶补充装 防蚊孕妇宝宝新生儿驱蚊液
  73    33.80           御信堂婴儿蚊香液套装儿童宝宝电热驱蚊液孕妇无味灭蚊液送加热器
  74    95.00           安贝儿电热蚊香液无味驱蚊婴儿专用儿童孕妇新生宝宝用的电蚊香液
  75    26.32           皎洁 电热蚊香液8瓶补充套装宝宝婴儿无味驱蚊液孕妇宝宝防蚊水
  76    25.80           麦康舒酷 婴儿电热蚊香片套装90片1器儿童驱蚊片宝宝防蚊片无香型
  77    39.80           安贝儿儿童电热蚊香片婴儿新生儿宝宝孕妇专用无味型电文香驱蚊片
  78    42.00           安贝儿电热蚊香液婴儿无味儿童电蚊香液孕妇驱蚊防蚊液宝宝电蚊液
  79    99.90           幼蓓Ubee电热蚊香液45ml*2瓶送蚊香器婴儿宝宝儿童无味驱蚊防蚊液
  80    19.90           布朗天使新生婴儿电热蚊香液宝宝孕妇无味防蚊儿童驱蚊液3液1器
```